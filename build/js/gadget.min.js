$(document).ready(function(){function e(){$.when(sites.getSites()).done(function(e){var n=sites.sortData(e);$.each(n,function(e,n){s.push(n.site),t(n)})})}function t(e){var t=$("#checkedOut tbody").append($(sites.createTableRow(e)));$("#checkedOut tbody").append(t),$.when(files.getFiles(e.site)).done(function(t){var s=files.getActiveFiles(t);$(".site."+e.site).find(".count").append(s.length+" files"),$(".site."+e.site).addClass("count"+s.length);var i=$("<a/>").attr({"class":"btn btn-outline-info btn-sm float-right"}).html("Check In");0==s.length?$(i).addClass("disabled"):i.on("click",function(){n(s)}),$(".site."+e.site).find(".button").append(i)})}function n(e){if(0!=e.length){var t=e[0].site;files.checkInFiles(e),$(".site."+t).find(".count").html("0 files"),$(".site."+t).find(".btn").addClass("disabled"),$(".site."+t).addClass("count0"),$(".toggleSites").hasClass("active")&&$(".site."+t).addClass("visible")}}var s=[];gadget.ready().then(gadget.fetch).then(function(){console.log("Gadget Ready, let's get to work."),e()}).fail(function(e){(e.responseText.code="SESSION_NOT_FOUND")&&$("#checkedOut tbody").append('<tr colspan="3"><td><strong>Error (SESSION_NOT_FOUND)</strong><br/> This can happen when your authorization token has expired. Please try refreshing the entire page.</td></tr>'),console.log("gadget.ready fail!",e)}),$(".btn.checkInAll").on("click",function(){$.each(s,function(e,t){_button=$("."+t).not(".count0").find("a.btn").click()})}),$(".btn.refresh").on("click",function(){$("#checkedOut tbody").html(""),$(".toggleSites").removeClass("active"),e()}),$(".btn.toggleSites").on("click",function(){$(this).toggleClass("active");var e=$(this).hasClass("active");$.each(s,function(t,n){$("."+n).hasClass("count0")&&(e?$("."+n).addClass("visible"):$("."+n).removeClass("visible"))})})}),function(e){"use strict";function t(e){var t=$.Deferred(),n={authorization_token:gadget.token,site:e.site,path:e.path};return $.ajax({dataType:"json",url:gadget.apihost+"/files/checkin",data:n,type:"POST"}).done(function(n){console.log("file checked in:",e.path),t.resolve(!0)}).fail(function(e){console.log("/files/checkedout error",e),t.resolve(!1)}),t.promise()}var n={getFiles:function(e){var t=$.Deferred(),n={authorization_token:gadget.token,site:e};return $.ajax({dataType:"json",url:gadget.apihost+"/files/checkedout",data:n}).done(function(e){t.resolve(e)}).fail(function(e){console.log("/files/checkedout error",e)}),t.promise()},getActiveFiles:function(e){var t=[];return $.each(e,function(e,n){n.is_scheduled_to_publish||n.is_scheduled_to_expire||n.pending_approval||t.push(n)}),t},checkInFiles:function(e){$.each(e,function(e,n){console.log("file",n.site,n.path),t(n)})}};e.files=n}(this),function(e){"use strict";var t={getSites:function(){var e=$.Deferred(),t={authorization_token:gadget.token};return $.ajax({dataType:"json",url:gadget.apihost+"/sites/list",data:t}).done(function(t){e.resolve(t)}).fail(function(e){console.log("/sites/list error",e)}),e.promise()},sortData:function(e){var t=e.sort(function(e,t){var n=e.site.toUpperCase(),s=t.site.toUpperCase();return n<s?-1:n>s?1:0});return t},createTableRow:function(e){return'<tr class="site '+e.site+'"><td class="site"><a href="https://a.cms.omniupdate.com/10/#oucampus/'+gadget.account+"/"+e.site+'/" target="_parent">'+e.site+'</a></td><td width="20%" class="count"></td><td width="20%" class="button"></td></tr>'}};e.sites=t}(this);