$(document).ready(function(){function t(){$.when(sites.getSites()).done(function(t){var n=sites.sortData(t);$.each(n,function(t,n){i.push(n.site),e(n)})})}function e(t){var e=$("#checkedOut tbody").append($(sites.createTableRow(t)));$("#checkedOut tbody").append(e),$.when(files.getFiles(t.site)).done(function(e){var i=files.getActiveFiles(e);$(".site."+t.site).find(".count").append(i.length+" files"),$(".site."+t.site).addClass("count"+i.length);var s=$("<a/>").attr({"class":"btn btn-outline-info btn-sm float-right"}).html("Check In");s.on("click",function(){n(i)}),$(".site."+t.site).find(".button").append(s)})}function n(t){if(0!=t.length){var e=t[0].site;files.checkInFiles(t),$(".site."+e).find(".count").html("0 files"),$(".site."+e).addClass("count0"),$(".toggleSites").hasClass("active")&&$(".site."+e).addClass("visible")}}var i=[];gadget.ready().then(gadget.fetch).then(function(){console.log("Gadget Ready, let's get to work."),t()}).fail(function(t){(t.responseText.code="SESSION_NOT_FOUND")&&$("#checkedOut tbody").append('<tr colspan="3"><td><strong>Error (SESSION_NOT_FOUND)</strong><br/> This can happen when your authorization token has expired. Please try refreshing the entire page.</td></tr>'),console.log("gadget.ready fail!",t)}),$(".btn.checkInAll").on("click",function(){$.each(i,function(t,e){_button=$("."+e).not(".count0").find("a.btn").click()})}),$(".btn.refresh").on("click",function(){$("#checkedOut tbody").html(""),$(".toggleSites").removeClass("active"),t()}),$(".btn.toggleSites").on("click",function(){$(this).toggleClass("active");var t=$(this).hasClass("active");$.each(i,function(e,n){$("."+n).hasClass("count0")&&(t?$("."+n).addClass("visible"):$("."+n).removeClass("visible"))})})}),function(t){"use strict";function e(t){var e=$.Deferred(),n={authorization_token:gadget.token,site:t.site,path:t.path};return $.ajax({dataType:"json",url:gadget.apihost+"/files/checkin",data:n,type:"POST"}).done(function(n){console.log("file checked in:",t.path),e.resolve(!0)}).fail(function(t){console.log("/files/checkedout error",t),e.resolve(!1)}),e.promise()}var n={getFiles:function(t){var e=$.Deferred(),n={authorization_token:gadget.token,site:t};return $.ajax({dataType:"json",url:gadget.apihost+"/files/checkedout",data:n}).done(function(t){e.resolve(t)}).fail(function(t){console.log("/files/checkedout error",t)}),e.promise()},getActiveFiles:function(t){var e=[];return $.each(t,function(t,n){n.is_scheduled_to_publish||n.is_scheduled_to_expire||n.pending_approval||e.push(n)}),e},checkInFiles:function(t){$.each(t,function(t,n){console.log("file",n.site,n.path),e(n)})}};t.files=n}(this),function(t){"use strict";var e={getSites:function(){var t=$.Deferred(),e={authorization_token:gadget.token};return $.ajax({dataType:"json",url:gadget.apihost+"/sites/list",data:e}).done(function(e){t.resolve(e)}).fail(function(t){console.log("/sites/list error",t)}),t.promise()},sortData:function(t){var e=t.sort(function(t,e){var n=t.site.toUpperCase(),i=e.site.toUpperCase();return n<i?-1:n>i?1:0});return e},createTableRow:function(t){return'<tr class="site '+t.site+'"><td class="site"><a href="https://a.cms.omniupdate.com/10/#oucampus/'+gadget.account+"/"+t.site+'/" target="_parent">'+t.site+'</a></td><td width="20%" class="count"></td><td width="20%" class="button"></td></tr>'}};t.sites=e}(this);